<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="./resources/ol.css">
        <link rel="stylesheet" href="resources/fontawesome-all.min.css">
        <link rel="stylesheet" href="./resources/ol-layerswitcher.css">
        <link rel="stylesheet" href="./resources/qgis2web.css">
        <style>
        html, body {
            background-color: #ffffff;
        }
        .ol-control > * {
            background-color: #f8f8f8!important;
            color: #444444!important;
            border-radius: 0px;
        }
        .ol-attribution a, .gcd-gl-input::placeholder, .search-layer-input-search::placeholder {
            color: #444444!important;
        }
        .search-layer-input-search {
            background-color: #f8f8f8!important;
        }
        .ol-control > *:focus, .ol-control >*:hover {
            background-color: rgba(248, 248, 248, 0.7)!important;
        } 
        .ol-control {
            background-color: rgba(255,255,255,.4) !important;
            padding: 2px !important;
        } 
        </style>

        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;


}
#slider-container {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 10px;
    border-radius: 5px;
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
    z-index: 1000;
}
#slider {
    width: 300px;
}

#graph-container {
    position: absolute;
    bottom: 80px;       
    left: 20px;         
    width: 300px;       
    background: white;
    padding: 8px;
    border-radius: 6px;
    box-shadow: 0 0 8px rgba(0,0,0,0.2);
    z-index: 999;
}

.graph-frame {
    display: none;
    width: 100%;
    height: auto;
    border: 1px solid #ccc;
    border-radius: 4px;
}

#graph-container-arrivals {
    position: absolute;
    bottom: 230px;    
    left: 1px;       
    width: 300px;
    background: white;
    padding: 8px;
    border-radius: 6px;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
    z-index: 999;
}


.graph-frame-arrival {
    display: none;
    width: 100%;
    height: auto;
    border: 1px solid #ccc;
    border-radius: 4px;
}


</style>


        <title>Geodesic Time Slider</title>

    </head>
    <body>
        <div id="map">
            <div id="popup" class="ol-popup">
                <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                <div id="popup-content"></div>
            </div>
        </div>

        <div id="slider-container">
            <label for="slider">Time (minutes): <span id="slider-value">0</span></label>
            <input type="range" id="slider" min="0" max="1000" step="1" value="0">
        </div>
<div id="graph-container">
    <!-- Graph images (1 per step) -->
<img class="graph-frame" data-step="1" src="graphs/graph_step_01.png">
<img class="graph-frame" data-step="2" src="graphs/graph_step_02.png">
<img class="graph-frame" data-step="3" src="graphs/graph_step_03.png">
<img class="graph-frame" data-step="4" src="graphs/graph_step_04.png">
<img class="graph-frame" data-step="5" src="graphs/graph_step_05.png">
<img class="graph-frame" data-step="6" src="graphs/graph_step_06.png">
<img class="graph-frame" data-step="7" src="graphs/graph_step_07.png">
<img class="graph-frame" data-step="8" src="graphs/graph_step_08.png">
<img class="graph-frame" data-step="9" src="graphs/graph_step_09.png">
<img class="graph-frame" data-step="10" src="graphs/graph_step_10.png">
<img class="graph-frame" data-step="11" src="graphs/graph_step_11.png">
<img class="graph-frame" data-step="12" src="graphs/graph_step_12.png">
<img class="graph-frame" data-step="13" src="graphs/graph_step_13.png">
<img class="graph-frame" data-step="14" src="graphs/graph_step_14.png">
<img class="graph-frame" data-step="15" src="graphs/graph_step_15.png">
<img class="graph-frame" data-step="16" src="graphs/graph_step_16.png">
<img class="graph-frame" data-step="17" src="graphs/graph_step_17.png">
<img class="graph-frame" data-step="18" src="graphs/graph_step_18.png">
<img class="graph-frame" data-step="19" src="graphs/graph_step_19.png">
<img class="graph-frame" data-step="20" src="graphs/graph_step_20.png">
<img class="graph-frame" data-step="21" src="graphs/graph_step_21.png">
<img class="graph-frame" data-step="22" src="graphs/graph_step_22.png">
<img class="graph-frame" data-step="23" src="graphs/graph_step_23.png">
<img class="graph-frame" data-step="24" src="graphs/graph_step_24.png">
<img class="graph-frame" data-step="25" src="graphs/graph_step_25.png">
<img class="graph-frame" data-step="26" src="graphs/graph_step_26.png">
<img class="graph-frame" data-step="27" src="graphs/graph_step_27.png">
<img class="graph-frame" data-step="28" src="graphs/graph_step_28.png">
<img class="graph-frame" data-step="29" src="graphs/graph_step_29.png">
<img class="graph-frame" data-step="30" src="graphs/graph_step_30.png">
<img class="graph-frame" data-step="31" src="graphs/graph_step_31.png">
<img class="graph-frame" data-step="32" src="graphs/graph_step_32.png">
<img class="graph-frame" data-step="33" src="graphs/graph_step_33.png">
<img class="graph-frame" data-step="34" src="graphs/graph_step_34.png">
<img class="graph-frame" data-step="35" src="graphs/graph_step_35.png">
<img class="graph-frame" data-step="36" src="graphs/graph_step_36.png">
<img class="graph-frame" data-step="37" src="graphs/graph_step_37.png">
<img class="graph-frame" data-step="38" src="graphs/graph_step_38.png">
<img class="graph-frame" data-step="39" src="graphs/graph_step_39.png">
<img class="graph-frame" data-step="40" src="graphs/graph_step_40.png">
<img class="graph-frame" data-step="41" src="graphs/graph_step_41.png">
<img class="graph-frame" data-step="42" src="graphs/graph_step_42.png">
<img class="graph-frame" data-step="43" src="graphs/graph_step_43.png">
<img class="graph-frame" data-step="44" src="graphs/graph_step_44.png">
<img class="graph-frame" data-step="45" src="graphs/graph_step_45.png">
<img class="graph-frame" data-step="46" src="graphs/graph_step_46.png">
<img class="graph-frame" data-step="47" src="graphs/graph_step_47.png">
<img class="graph-frame" data-step="48" src="graphs/graph_step_48.png">
<img class="graph-frame" data-step="49" src="graphs/graph_step_49.png">
<img class="graph-frame" data-step="50" src="graphs/graph_step_50.png">
<img class="graph-frame" data-step="51" src="graphs/graph_step_51.png">
<img class="graph-frame" data-step="52" src="graphs/graph_step_52.png">
<img class="graph-frame" data-step="53" src="graphs/graph_step_53.png">
<img class="graph-frame" data-step="54" src="graphs/graph_step_54.png">
<img class="graph-frame" data-step="55" src="graphs/graph_step_55.png">
<img class="graph-frame" data-step="56" src="graphs/graph_step_56.png">
<img class="graph-frame" data-step="56" src="graphs/graph_step_57.png">


<div>

<div id="graph-container-arrivals">
<img class="graph-frame-arrival" data-step="1" src="graphs_arrivals/graph_step_01.png">
<img class="graph-frame-arrival" data-step="2" src="graphs_arrivals/graph_step_02.png">
<img class="graph-frame-arrival" data-step="3" src="graphs_arrivals/graph_step_03.png">
<img class="graph-frame-arrival" data-step="4" src="graphs_arrivals/graph_step_04.png">
<img class="graph-frame-arrival" data-step="5" src="graphs_arrivals/graph_step_05.png">
<img class="graph-frame-arrival" data-step="6" src="graphs_arrivals/graph_step_06.png">
<img class="graph-frame-arrival" data-step="7" src="graphs_arrivals/graph_step_07.png">
<img class="graph-frame-arrival" data-step="8" src="graphs_arrivals/graph_step_08.png">
<img class="graph-frame-arrival" data-step="9" src="graphs_arrivals/graph_step_09.png">
<img class="graph-frame-arrival" data-step="10" src="graphs_arrivals/graph_step_10.png">
<img class="graph-frame-arrival" data-step="11" src="graphs_arrivals/graph_step_11.png">
<img class="graph-frame-arrival" data-step="12" src="graphs_arrivals/graph_step_12.png">
<img class="graph-frame-arrival" data-step="13" src="graphs_arrivals/graph_step_13.png">
<img class="graph-frame-arrival" data-step="14" src="graphs_arrivals/graph_step_14.png">
<img class="graph-frame-arrival" data-step="15" src="graphs_arrivals/graph_step_15.png">
<img class="graph-frame-arrival" data-step="16" src="graphs_arrivals/graph_step_16.png">
<img class="graph-frame-arrival" data-step="17" src="graphs_arrivals/graph_step_17.png">
<img class="graph-frame-arrival" data-step="18" src="graphs_arrivals/graph_step_18.png">
<img class="graph-frame-arrival" data-step="19" src="graphs_arrivals/graph_step_19.png">
<img class="graph-frame-arrival" data-step="20" src="graphs_arrivals/graph_step_20.png">
<img class="graph-frame-arrival" data-step="21" src="graphs_arrivals/graph_step_21.png">
<img class="graph-frame-arrival" data-step="22" src="graphs_arrivals/graph_step_22.png">
<img class="graph-frame-arrival" data-step="23" src="graphs_arrivals/graph_step_23.png">
<img class="graph-frame-arrival" data-step="24" src="graphs_arrivals/graph_step_24.png">
<img class="graph-frame-arrival" data-step="25" src="graphs_arrivals/graph_step_25.png">
<img class="graph-frame-arrival" data-step="26" src="graphs_arrivals/graph_step_26.png">
<img class="graph-frame-arrival" data-step="27" src="graphs_arrivals/graph_step_27.png">
<img class="graph-frame-arrival" data-step="28" src="graphs_arrivals/graph_step_28.png">
<img class="graph-frame-arrival" data-step="29" src="graphs_arrivals/graph_step_29.png">
<img class="graph-frame-arrival" data-step="30" src="graphs_arrivals/graph_step_30.png">
<img class="graph-frame-arrival" data-step="31" src="graphs_arrivals/graph_step_31.png">
<img class="graph-frame-arrival" data-step="32" src="graphs_arrivals/graph_step_32.png">
<img class="graph-frame-arrival" data-step="33" src="graphs_arrivals/graph_step_33.png">
<img class="graph-frame-arrival" data-step="34" src="graphs_arrivals/graph_step_34.png">
<img class="graph-frame-arrival" data-step="35" src="graphs_arrivals/graph_step_35.png">
<img class="graph-frame-arrival" data-step="36" src="graphs_arrivals/graph_step_36.png">
<img class="graph-frame-arrival" data-step="37" src="graphs_arrivals/graph_step_37.png">
<img class="graph-frame-arrival" data-step="38" src="graphs_arrivals/graph_step_38.png">
<img class="graph-frame-arrival" data-step="39" src="graphs_arrivals/graph_step_39.png">
<img class="graph-frame-arrival" data-step="40" src="graphs_arrivals/graph_step_40.png">
<img class="graph-frame-arrival" data-step="41" src="graphs_arrivals/graph_step_41.png">
<img class="graph-frame-arrival" data-step="42" src="graphs_arrivals/graph_step_42.png">
<img class="graph-frame-arrival" data-step="43" src="graphs_arrivals/graph_step_43.png">
<img class="graph-frame-arrival" data-step="44" src="graphs_arrivals/graph_step_44.png">
<img class="graph-frame-arrival" data-step="45" src="graphs_arrivals/graph_step_45.png">
<img class="graph-frame-arrival" data-step="46" src="graphs_arrivals/graph_step_46.png">
<img class="graph-frame-arrival" data-step="47" src="graphs_arrivals/graph_step_47.png">
<img class="graph-frame-arrival" data-step="48" src="graphs_arrivals/graph_step_48.png">
<img class="graph-frame-arrival" data-step="49" src="graphs_arrivals/graph_step_49.png">
<img class="graph-frame-arrival" data-step="50" src="graphs_arrivals/graph_step_50.png">
<img class="graph-frame-arrival" data-step="51" src="graphs_arrivals/graph_step_51.png">
<img class="graph-frame-arrival" data-step="52" src="graphs_arrivals/graph_step_52.png">
<img class="graph-frame-arrival" data-step="53" src="graphs_arrivals/graph_step_53.png">
<img class="graph-frame-arrival" data-step="54" src="graphs_arrivals/graph_step_54.png">
<img class="graph-frame-arrival" data-step="55" src="graphs_arrivals/graph_step_55.png">
<img class="graph-frame-arrival" data-step="56" src="graphs_arrivals/graph_step_56.png">
<img class="graph-frame-arrival" data-step="56" src="graphs_arrivals/graph_step_57.png">

</div>



        <script src="resources/qgis2web_expressions.js"></script>
<script src="resources/proj4.js"></script>
        <script>proj4.defs('ESRI:54030','+proj=robin +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs');</script>
        <script src="./resources/functions.js"></script>
        <script src="./resources/ol.js"></script>
        <script src="./resources/ol-layerswitcher.js"></script>
        <script src="layers/Estimatingflighttimesminutes_1.js"></script><script src="layers/OriginsSpain_2.js"></script><script src="layers/DestinationsUnitedKingdom_3.js"></script>
        <script src="styles/Estimatingflighttimesminutes_1_style.js"></script><script src="styles/OriginsSpain_2_style.js"></script><script src="styles/DestinationsUnitedKingdom_3_style.js"></script>
        <script src="./layers/layers.js" type="text/javascript"></script> 
        <script src="./resources/Autolinker.min.js"></script>
        <script src="./resources/qgis2web.js"></script>



        <script>
        function waitForLayerByName(partialName, callback) {
            const check = setInterval(() => {
                if (typeof layersList !== "undefined") {
                    const layer = layersList.find(l => {
                        const title = l.get("title") || "";
                        return title.includes(partialName);
                    });
                    if (layer) {
                        clearInterval(check);
                        callback(layer);
                    }
                }
            }, 100);
        }

  waitForLayerByName("Estimatingflighttimesminutes_1", function (targetLayer) {
    const slider = document.getElementById("slider");
    const sliderValue = document.getElementById("slider-value");

    const features = targetLayer.getSource().getFeatures();
    features.forEach(f => {
        f.set("originalStyle", f.getStyle());
    });

    function updateFeaturesVisibility(maxTime) {
        features.forEach(feature => {
            const time = parseFloat(feature.get("aika_min_1"));
            if (!isNaN(time)) {
                feature.setStyle(time <= maxTime ? feature.get("originalStyle") : new ol.style.Style({}));
            }
        });
    }

    const times = features
        .map(f => parseFloat(f.get("aika_min_1")))
        .filter(t => !isNaN(t))
        .sort((a, b) => a - b);

    const maxTime = Math.ceil(Math.max(...times));
    slider.max = maxTime;
    slider.value = 0;
    sliderValue.textContent = "0";

    updateFeaturesVisibility(0);

    const graphImages = document.querySelectorAll(".graph-frame");
const graphImagesArrival = document.querySelectorAll(".graph-frame-arrival");


slider.addEventListener("input", () => {
    const value = parseFloat(slider.value);
    sliderValue.textContent = value;
    updateFeaturesVisibility(value);

    const step = Math.round(value);
    const visibleCount = times.filter(t => t <= value).length;

    // Show the correct departure graph
    graphImages.forEach((img, index) => {
        img.style.display = (index === visibleCount - 1) ? "block" : "none";
    });

    // Show the correct arrival graph
    graphImagesArrival.forEach((img, index) => {
        img.style.display = (index === visibleCount - 1) ? "block" : "none";
    });
}); 

}); 
</script>
</body>

<div id="map-title" style="
    position: absolute;
    top: -600px;
    left: 40px;
    background-color: rgba(255, 255, 255, 0.85);
    padding: 6px 10px;
    font-size: 13px;
    font-family: 'Century Gothic', sans-serif;
    line-height: 1.4;
    border-radius: 6px;
    z-index: 1000;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
  <strong>Mapping Mobility of Erasmus Students from Spain to United Kingdom (2018)</strong><br>
  <em>Sources: Mobi-Twin Project, Digital Geography Lab, University of Helsinki </em>
</div>

</html>


